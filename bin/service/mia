#! /bin/bash

. /etc/init.d/functions

pidfile="/home/karotz/mia/mid.pid"

start() {
  echo -n $"Starting Sinatra Mia: "	
  if [ -e ${pidfile}] && [ -e /proc/`cat ${pidfile}` ]; then
    echo -n $"cannot start ruby lib/server.rb: it is already running.";
    failure $"cannot start ruby lib/server.rb: it is already running.";
    echo
    return 1
  fi
  daemon ruby lib/server.rb --pidfile ${pidfile}
  RETVAL=$?
  return $RETVAL
}

stop() {
  echo -n $"Stopping Sinatra Mia: "
  if [ ! -e /var/lock/subsys/crond ]; then
    echo -n $"cannot stop ruby lib/server.rb: it is not running."
    failure $"cannot stop ruby lib/server.rb: it is not running."
    echo
    return 1;
  fi
  killproc -p $pidfile
  RETVAL=$?
  return $RETVAL
}	

restart() {
  stop
  start
}	

case "$1" in
  start)
    start
    ;;
  stop)
    stop
    ;;
  restart)
    restart
    ;;
  *)
    echo $"Usage: $0 {start|stop|restart}"
    exit 1
esac
