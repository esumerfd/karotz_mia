#! /bin/bash

. /etc/init.d/functions

pidfile="/home/karotz/mia/mia.pid"

start() {
  echo -n $"Starting Sinatra Mia: "	
  if [ -e ${pidfile} ] && [ -e /proc/`cat ${pidfile}` ]; then
    echo -n $"cannot start mia: it is already running.";
    failure $"cannot start mia: it is already running.";
    echo
    return 1
  fi
  daemon --user karotz --pidfile ${pidfile} "cd /home/karotz/mia/current;/usr/local/bin/ruby lib/server.rb"
  RETVAL=$?
  echo
  return $RETVAL
}

stop() {
  echo -n $"Stopping Sinatra Mia: "
  if [ ! -e ${pidfile} ] || [ ! -e /proc/`cat ${pidfile}` ]; then
    echo -n $"cannot stop mia it is not running."
    failure $"cannot stop mia it is not running."
    echo
    return 1;
  fi
  killproc -p $pidfile
  RETVAL=$?
  echo
  return $RETVAL
}	

restart() {
  stop
  start
}	

case "$1" in
  start)
    start
    ;;
  stop)
    stop
    ;;
  restart)
    restart
    ;;
  *)
    echo $"Usage: $0 {start|stop|restart}"
    exit 1
esac
